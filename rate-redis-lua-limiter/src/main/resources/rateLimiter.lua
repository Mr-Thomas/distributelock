---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Administrator.
--- DateTime: 2021/8/7 23:17
---
---- 1s内限制访问：limit
-- 获取方法特征
local key = KEYS[1]
redis.log(redis.LOG_DEBUG, 'key is', key)
-- 调用脚本传入限流大小
local limit = tonumber(ARGV[1])
-- 获取当前限流大小
local count = tonumber(redis.call('get', key) or "0")
-- 是否超出限流预置
if count + 1 > limit then
    -- 拒绝服务访问
    return false
else
    -- 没有超过预置
    -- 设置当前访问的数量+1
    redis.call("INCRBY", key, 1)
    -- 设置过期时间 1秒【1s内限制访问：limit】
    redis.call("EXPIRE", key, 1)
    return true
end